<!-- User profile -->
<%
    var isEmail = typeof includeSVG !== "undefined";
    // Add string capitalize functions to ejs.
    String.prototype.capitalize = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
    };
    String.prototype.capitalizeAll = function() {
        var words = this.split(' ');
        for(var i=0; i<words.length; i++) {
            words[i] = words[i].capitalize();
        }
        return words.join(' ');
    };
%>
<div class="profile-card">
    <div class="inner-container">
        <div class="row profile-container bg-<%= user.hasPlace ? 'info' : 'primary' %>">
            <div class="col col-sm-4">
                <div class="btn-circle-lg btn-photo" style="background-image: url('<%= user.photoUrl %>');"></div>
            </div>
            <div class="col col-sm-8">
                <h2><%= user.name %></h2>
                <p><strong><%= user.position.capitalizeAll() %> (<%= user.role.capitalizeAll() %>)</strong></p>
                <%
                    // Find location in array of objects.
                    var locationName = "";
                    var idx = user.startLocation;
                    var j = 0;
                    while(locations[j].cities.length < idx) {
                        idx -= locations[j].cities.length;
                        j++;
                    }
                    locationName = locations[j].cities[idx];
                %>
                <p><%= locationName %></p>
            </div>
            <% if(user.hasPlace) { %>
                <<%- isEmail ? 'div' : 'a href="javascript:;"' %> class="tip float text-info" data-toggle="tooltip" data-placement="auto" title="This Noogler has a residence already">
                    <span class="glyphicon glyphicon-ok"></span> 
                    <%= isEmail ? 'Already has a place' : 'Has Place' %>
                </<%= isEmail ? 'div' : 'a' %>>
            <% } else { %>
                <<%- isEmail ? 'div' : 'a href="javascript:;"' %> class="tip float text-primary" data-toggle="tooltip" data-placement="auto" title="This Noogler is looking for a residence">
                    <span class="glyphicon glyphicon-search"></span> 
                    <%= isEmail ? 'Looking for a place' : 'Looking' %>
                </<%= isEmail ? 'div' : 'a' %>>
            <% } %>
        </div>
        <div class="data-container">
            <div class="row">
                <div class="col col-xs-6">
                    <p>
                        <% if(!isEmail) { %>
                        <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Start date">
                            <% } %>
                            <span class="glyphicon glyphicon-calendar text-<%= user.hasPlace ? 'info' : 'primary' %>"></span>
                            <label class="bg-<%= user.hasPlace ? 'info' : 'primary' %>"><%= isEmail ? 'Start Date:' : '' %></label>
                            <strong id="dateToFormat"><%= isEmail ? startDate : user.startDate %></strong>
                        <% if(!isEmail) { %>
                        </a>
                        <% } %>
                    </p>
                </div>
                <div class="col col-xs-6">
                    <p>
                        <% if(user.hasPlace) { %>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Lease duration">
                            <% } %>
                                <span class="glyphicon glyphicon-time text-info"></span> 
                                <label class="bg-info"><%= isEmail ? 'Lease duration:' : '' %></label>
                                <%
                                    var duration = user.currentResidence.durationInMonths + " months";
                                    if(user.currentResidence.durationInMonths == -1)
                                        duration = "Any period";
                                %>
                                <strong><%= duration %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        <% } else { %>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Desired duration of stay">
                            <% } %>
                                <span class="glyphicon glyphicon-time text-primary"></span> 
                                <label class="bg-primary"><%= isEmail ? 'Desired stay duration:' : '' %></label>
                                <%
                                    var duration = user.preferences.durationInMonths + " months";
                                    if(user.preferences.durationInMonths == -1)
                                        duration = "Any period";
                                %>
                                <strong><%= duration %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        <% } %>
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col col-xs-6">
                    <p>
                        <% if(user.hasPlace) { %>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" data-toggle="tooltip" data-placement="auto" title="Type of residence">
                            <% } %>
                                <span class="glyphicon glyphicon-home text-info"></span> 
                                <label class="bg-info"><%= isEmail ? 'Type of residence:' : '' %></label>
                                <%
                                    var resType = user.currentResidence.residenceType.capitalize();
                                    if(user.currentResidence.residenceType == "idc")
                                        resType = "Anything";
                                %>
                                <strong><%= resType %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        <% } else { %>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Desired residence">
                            <% } %>
                                <span class="glyphicon glyphicon-home text-primary"></span> 
                                <label class="bg-primary"><%= isEmail ? 'Desired residence:' : '' %></label>
                                <%
                                    var resType = user.preferences.residenceType.capitalize();
                                    if(user.preferences.residenceType == "idc")
                                        resType = "Anything";
                                %>
                                <strong><%= resType %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        <% } %>
                    </p>
                </div>
                <div class="col col-xs-6">
                    <p>
                        <% if(user.hasPlace) { %>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Available/vacant rooms">
                            <% } %>
                                <span class="glyphicon glyphicon-user text-info"></span> 
                                <label class="bg-info"><%= isEmail ? 'Available rooms:' : '' %></label>
                                <% var numRoommates = user.currentResidence.vacantRooms %>
                                <strong>+<%= numRoommates+(numRoommates>1?"people":"person") %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        <% } else { %>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Desired roommates">
                            <% } %>
                                <span class="glyphicon glyphicon-user text-primary"></span> 
                                <label class="bg-primary"><%= isEmail ? 'Desired roommates:' : '' %></label>
                                <% var numRoommates = user.preferences.roommates %>
                                <strong>+<%= numRoommates+" "+(numRoommates>1?"people":"person") %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        <% } %>
                    </p>
                </div>
            </div>
            <div class="row">
                <% if(user.hasPlace) { %>
                    <div class="col col-xs-6">
                        <p>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="City of residence">
                            <% } %>
                                <span class="glyphicon glyphicon-map-marker text-info"></span> 
                                <label class="bg-info"><%= isEmail ? 'City of residence:' : '' %></label>
                                <strong><%= user.currentResidence.location %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        </p>
                    </div>
                    <div class="col col-xs-6">
                        <p>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Bathrooms in residence">
                            <% } %>
                                <span class="glyphicon glyphicon-tint text-info"></span> 
                                <label class="bg-info"><%= isEmail ? 'Bathrooms in residence:' : '' %></label>
                                <strong><%= user.currentResidence.bathrooms %> bathrooms</strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        </p>
                    </div>
                <% } else { %>
                    <div class="col col-xs-12">
                        <p>
                            <% if(!isEmail) { %>
                            <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Preferred cities to live in">
                            <% } %>
                                <span class="glyphicon glyphicon-map-marker text-primary"></span> 
                                <label class="bg-primary"><%= isEmail ? 'Preferred cities to live in:' : '' %></label>
                                <strong><%= user.preferences.locations.join(', ') %></strong>
                            <% if(!isEmail) { %>
                            </a>
                            <% } %>
                        </p>
                    </div>
                <% } %>
            </div>
            <div class="row">
                <div class="col col-xs-12">
                    <p>
                        <% if(!isEmail) { %>
                        <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="tip" data-toggle="tooltip" data-placement="auto" title="Most important factors">
                        <% } %>
                            <span class="glyphicon glyphicon-heart text-<%= user.hasPlace ? 'info' : 'primary' %>"></span> 
                            <label class="bg-<%= user.hasPlace ? 'info' : 'primary' %>"><%= isEmail ? 'Importance ratings:' : '' %></label>
                            <strong id="factorsToSort" data-factors='<%- isEmail ? '' : JSON.stringify(user.factors) %>'>
                                <%= isEmail ? topFactors : '' %>
                            </strong>
                        <% if(!isEmail) { %>
                        </a>
                        <% } %>
                    </p>
                </div>
            </div>
            <div class="row">
                <p class="desc" data-desc="<%= user.aboutMe %>">
                    <span><%= user.aboutMe %></span>
                    <a href="<%= isEmail ? '#' : 'javascript:;' %>" class="more" onclick="toggleReadMore(event,this);">More</a>
                </p>
            </div>
        </div>
        <div class="message-container">
            <div class="row email">
                <a href="<%= isEmail ? 'mailto:'+user.email : 'javascript:;' %>" data-toggle="tooltip" data-placement="auto" title="Your email is not publicly visibile. When other users send you messages, you will receive them at this email." class="btn btn-<%= user.hasPlace ? 'info' : 'primary' %>">
                    <span class="btn-text"><%= user.email %></span>
                </a>
            </div>
        </div>
    </div>
</div>